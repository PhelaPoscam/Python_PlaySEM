# üéÆ Comprehensive Control Panel Guide

## Overview

The Control Panel provides a user-friendly web interface for testing and controlling your PythonPlaySEM devices in real-time. It is the recommended way to interact with the framework for debugging, device management, and advanced testing workflows.

**IMPORTANT ‚Äî Canonical PlaySEM Flow:**
- For **quick end-to-end tests**, the most direct method is using `examples/demos/websocket_server_demo.py` combined with `examples/web/websocket_client.html`. This is the minimal and preferred way to verify a basic PlaySEM setup.
- The **Control Panel** described in this guide is a richer, full-featured application for when you need to manage multiple devices, discover them on the network, and access more advanced debugging tools.

---

## üöÄ Quick Start

This quick start will get you running with the full control panel.

### 1. Start the Server

In your activated `(venv)` terminal, run the following command:
```bash
python examples/control_panel/control_panel_server.py
```
The server will start on `http://localhost:8090`.

### 2. Open in Browser

**Desktop:** Navigate to http://localhost:8090

**Mobile Phone:**
- Find your PC's IP address (e.g., `192.168.1.100`).
- Open a browser on your phone and go to `http://YOUR_PC_IP:8090`.

### 3. Connect and Test
1.  Click the **"Connect"** button (WebSocket is selected by default).
2.  You should see "‚úÖ Connected to WebSocket server" in the log.
3.  Click any effect button (e.g., üí° Light) to send an effect to the server.
4.  Adjust the intensity and duration sliders and send more effects.
5.  Watch the server terminal and the control panel's activity log for real-time updates.

---

## üì± Features

### üîå Server Connection
- Connect to the backend server.
- WebSocket is used for real-time updates.
- A status indicator shows the current connection status.

### üîç Device Discovery
- **Bluetooth (BLE):** Scan for nearby Bluetooth devices like phones, smartwatches, or haptic vests.
- **Serial (USB):** Automatically detect connected Arduino/ESP32 devices by listing all available COM ports.
- **MQTT (Network):** Connect to network devices via an MQTT broker.

### üì± Connected Devices
- View a list of all connected devices.
- Test each device individually.
- Disconnect devices when you're done.

### ‚ö° Effect Testing
- Select a target device from the list of connected devices.
- Choose an effect type (vibration, light, wind, etc.).
- Adjust intensity (0-100%) and duration (100-5000ms) with sliders.
- Use quick presets for common effect patterns:
  - **Short Buzz:** 20% / 200ms
  - **Medium Pulse:** 50% / 1s
  - **Strong Vibe:** 80% / 2s
  - **Maximum:** 100% / 3s

### ‚å®Ô∏è Keyboard Shortcuts (when connected)
- `L` - Trigger Light effect
- `W` - Trigger Wind effect
- `V` - Trigger Vibration effect
- `S` - Trigger Scent effect

### üìä System Statistics
- Total number of effects sent.
- Average effect latency.
- System uptime.
- Total error count.

### üìù Activity Log
- A real-time log of all system events.
- See connection events, effect dispatch results, and error messages.

---

## üß™ Usage Scenarios & Testing

### üì≥ Laptop ‚Üí Phone via WebSocket (Recommended for quick phone tests)

This method uses the lightweight WebSocket demo to test phone vibration without needing the full control panel server.

1.  **Start the WebSocket server demo** (on your laptop):
    ```powershell
    .venv\Scripts\python.exe examples\demos\websocket_server_demo.py
    ```

2.  **Serve the web client** (so your phone can load it over HTTP):
    ```powershell
    # From the repo root, in a new terminal
    cd examples\web
    python -m http.server 8000
    ```

3.  **On your phone** (connected to the same Wi-Fi):
    - Open the QR code generated by the server, or manually navigate to `http://<YOUR_PC_IP>:8000/websocket_client.html`.
    - The WebSocket URL should be pre-filled.
    - Check the "Phone mode" box.
    - Tap "Connect to Server".

4.  **Send a vibration effect:**
    - From another client (like the same page open on your laptop's browser), send a vibration effect. Your phone will vibrate.

### Scenario 1: Quick Phone Vibration Test
**Goal:** Verify your phone's Web Vibration API.
1.  Serve the phone tester page: `cd examples\web` and then `python phone_tester_server.py`.
2.  On your phone, open: `http://YOUR_PC_IP:8091/phone_tester.html`.
3.  Tap the "Short Buzz" button and feel the vibration immediately.

### Scenario 2: BLE Integration Test
**Goal:** Test Bluetooth connectivity and effect dispatch.
1.  Set up your phone as a BLE peripheral (using an app like nRF Connect).
2.  From the Control Panel, scan for Bluetooth devices.
3.  Connect to your phone.
4.  Send vibration effects and measure the latency in the activity log (should be < 150ms).

---

## üõ†Ô∏è Advanced Usage & Troubleshooting

### Advanced: MQTT Setup
If you want to test with MQTT (optional):
1.  **Install Mosquitto broker:** `choco install mosquitto` (on Windows).
2.  **Start broker:** `mosquitto`.
3.  The control panel server should detect the broker automatically on startup.
*Note: MQTT in the browser requires a WebSocket bridge, which is complex. The control panel shows this as unavailable for the browser client.*

### Troubleshooting
- **Control Panel won't load:** Check that the `control_panel_server.py` is running and that your firewall is not blocking port 8090.
- **Can't connect to devices:** For Bluetooth, ensure your device is advertising. For Serial, check that drivers are installed. For MQTT, verify the broker is running.
- **Phone not vibrating:** Make sure your phone is not in silent mode and that the browser has permission to use the Vibration API. Test with `phone_tester.html` first.

---

## üìÅ Relevant Files

- **`examples/control_panel/control_panel_server.py`**: The backend server for the control panel.
- **`examples/control_panel/control_panel.html`**: The web UI for the control panel.
- **`docs/MOBILE_PHONE_SETUP.md`**: Detailed guide for setting up your phone for testing.