"""Quick test script for GUI modules."""

import sys
from pathlib import Path

# Add project root to Python path for gui/tools imports
root_dir = Path(__file__).resolve().parent.parent.parent
if str(root_dir) not in sys.path:
    sys.path.insert(0, str(root_dir))

import asyncio
from gui.protocols import ProtocolFactory
from gui.app_controller import AppController, ConnectionConfig


async def test_websocket_protocol():
    """Test WebSocket protocol creation."""
    print("\n=== Testing WebSocket Protocol ===")
    protocol = ProtocolFactory.create("websocket", "localhost", 8090)
    if not protocol:
        print("✗ Failed to create WebSocket protocol")
        return False

    print(f"✓ WebSocket protocol created: {protocol.get_connection_info()}")
    print(f'✓ Protocol has send method: {hasattr(protocol, "send")}')
    print(f'✓ Protocol has connect method: {hasattr(protocol, "connect")}')
    print(
        f'✓ Protocol has disconnect method: {hasattr(protocol, "disconnect")}'
    )
    print(f'✓ Protocol has listen method: {hasattr(protocol, "listen")}')
    return True


async def test_http_protocol():
    """Test HTTP protocol creation."""
    print("\n=== Testing HTTP Protocol ===")
    protocol = ProtocolFactory.create("http", "localhost", 8090)
    if not protocol:
        print("✗ Failed to create HTTP protocol")
        return False

    print(f"✓ HTTP protocol created: {protocol.get_connection_info()}")
    print(f'✓ Protocol has send method: {hasattr(protocol, "send")}')
    return True


async def test_app_controller():
    """Test AppController."""
    print("\n=== Testing AppController ===")
    controller = AppController()
    print(f"✓ AppController created")
    print(f"✓ Initial state: connected={controller.is_running}")
    print(f"✓ Protocol: {controller.protocol}")
    return True


async def test_protocol_factory():
    """Test ProtocolFactory."""
    print("\n=== Testing ProtocolFactory ===")
    protocols = ProtocolFactory.available_protocols()
    print(f"✓ Available protocols: {protocols}")
    if "websocket" not in protocols:
        print("✗ WebSocket protocol not registered")
        return False
    if "http" not in protocols:
        print("✗ HTTP protocol not registered")
        return False
    return True


async def main():
    """Run all tests."""
    print("\n" + "=" * 50)
    print("PythonPlaySEM GUI - Module Tests")
    print("=" * 50)

    tests = [
        ("Protocol Factory", test_protocol_factory),
        ("WebSocket Protocol", test_websocket_protocol),
        ("HTTP Protocol", test_http_protocol),
        ("AppController", test_app_controller),
    ]

    results = []
    for name, test_func in tests:
        try:
            result = await test_func()
            results.append((name, result))
        except Exception as e:
            print(f"[X] {name} raised exception: {e}")
            results.append((name, False))

    # Summary
    print("\n" + "=" * 50)
    print("Test Summary")
    print("=" * 50)
    passed = sum(1 for _, r in results if r)
    total = len(results)

    for name, result in results:
        status = "✓ PASS" if result else "✗ FAIL"
        print(f"{status}: {name}")

    print(f"\nTotal: {passed}/{total} tests passed")

    if passed == total:
        print("\n✓ All tests passed! Ready for integration testing.")
        return 0
    else:
        print(f"\n✗ {total - passed} test(s) failed.")
        return 1


if __name__ == "__main__":
    exit_code = asyncio.run(main())
    exit(exit_code)
